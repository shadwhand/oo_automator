{% extends "base.html" %}

{% block title %}{{ test.name or "Test" }} - OO Automator{% endblock %}

{% block content %}
<div class="page-header">
    <a href="/" class="back-link">&larr; Back to Dashboard</a>
    <h1>{{ test.name or "(Unnamed Test)" }}</h1>
</div>

<section class="test-info-section">
    <div class="test-details">
        <div class="detail-item">
            <label>Test URL</label>
            <a href="{{ test.url }}" target="_blank" class="test-url-link">{{ test.url }}</a>
        </div>
        <div class="detail-row">
            <div class="detail-item">
                <label>Total Runs</label>
                <span class="value">{{ test.run_count }}</span>
            </div>
            <div class="detail-item">
                <label>Created</label>
                <span class="value">{{ test.created_at.strftime('%Y-%m-%d %H:%M') if test.created_at else 'N/A' }}</span>
            </div>
            <div class="detail-item">
                <label>Last Run</label>
                <span class="value">{{ test.last_run_at.strftime('%Y-%m-%d %H:%M') if test.last_run_at else 'Never' }}</span>
            </div>
        </div>
    </div>
    <div class="test-actions">
        <a href="/new-run?test_id={{ test.id }}" class="btn btn-primary">+ New Run for This Test</a>
    </div>
</section>

<section class="runs-section">
    <h2>All Runs ({{ runs|length }})</h2>
    {% if runs %}
    <table class="runs-table">
        <thead>
            <tr>
                <th>Run ID</th>
                <th>Mode</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for run in runs %}
            <tr class="run-row">
                <td><a href="/runs/{{ run.id }}">#{{ run.id }}</a></td>
                <td><span class="badge">{{ run.mode }}</span></td>
                <td><span class="status-badge status-{{ run.status }}">{{ run.status }}</span></td>
                <td>{{ run.created_at.strftime('%Y-%m-%d %H:%M') if run.created_at else 'N/A' }}</td>
                <td>
                    <a href="/runs/{{ run.id }}" class="btn btn-small">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty-state">No runs yet for this test.</p>
    {% endif %}
</section>

<style>
.test-info-section {
    background: var(--surface);
    padding: 24px;
    border-radius: 8px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 24px;
}

.test-details {
    flex: 1;
}

.detail-item {
    margin-bottom: 16px;
}

.detail-item label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 4px;
    text-transform: uppercase;
}

.detail-item .value {
    font-size: 1.1rem;
}

.test-url-link {
    color: var(--primary);
    word-break: break-all;
}

.detail-row {
    display: flex;
    gap: 32px;
}

.runs-table {
    width: 100%;
    border-collapse: collapse;
}

.runs-table th,
.runs-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

.runs-table th {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.runs-table a {
    color: var(--primary);
    text-decoration: none;
}

.runs-table a:hover {
    text-decoration: underline;
}

.btn-small {
    padding: 4px 12px;
    font-size: 0.875rem;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-pending {
    background: var(--warning-bg, #fef3c7);
    color: var(--warning-text, #92400e);
}

.status-running {
    background: var(--info-bg, #dbeafe);
    color: var(--info-text, #1e40af);
}

.status-completed {
    background: var(--success-bg, #d1fae5);
    color: var(--success-text, #065f46);
}

.status-failed, .status-stopped {
    background: var(--error-bg, #fee2e2);
    color: var(--error-text, #991b1b);
}
</style>
{% endblock %}
